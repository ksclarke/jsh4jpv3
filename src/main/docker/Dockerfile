ARG ALPINE_TAG

FROM eclipse-temurin:${ALPINE_TAG}-jdk-alpine

LABEL Maintainer="Kevin S. Clarke <ksclarke@ksclarke.io>"
LABEL ContainerName="${project.name}" ContainerSourceCode="${project.url}"

RUN apk add --no-cache nano curl && addgroup -S jpv3 && adduser -S jpv3 -G jpv3 -s bash

COPY --chown=jpv3:jpv3 --chmod=0400 "maven/jsh4jpv3-${project.version}-uber.jar" "/opt/jpv3.jar"
COPY --chown=jpv3:jpv3 --chmod=0400 "imports.jsh" "/etc/jshell/imports.jsh"

EXPOSE 8888

USER jpv3

CMD ["sh", "-c", "exec java ${JAVA_OPTS} -jar /opt/jpv3.jar"]
